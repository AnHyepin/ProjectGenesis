<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.green.backend.repository.dao.kwanhyun.CompanyDao">
    <select id="myBookmarkList" resultType="org.green.backend.dto.kwanhyun.BookmarkCompanyDto">
        SELECT l.like_id,
        c.name,
        c.address,
        (SELECT COUNT(*) FROM tbl_applications
        WHERE username = c.username
        AND delete_yn = 'N'
        AND application_code = 'O'
        AND start_date <= NOW()
        AND (deadline_date IS NULL OR deadline_date > NOW())
        ) AS 'count'
        FROM tbl_likes l
        JOIN tbl_companys c ON l.like_id = c.username
        WHERE l.username = #{username}
        AND l.like_code = 'G';
    </select>
</mapper>